import{d as $,c as i,a as l,u as r,h as C,w as n,b as t,o as d,F as g,r as v,t as a,e as y,f,g as u,i as A,j as b}from"./app-Db_P8R5x.js";import{_ as D}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-kFV-S-t7.js";import{_ as N,a as V,b as M,c as S,d as B}from"./DialogTitle.vue_vue_type_script_setup_true_lang-D4DXx-5m.js";import{_ as I,a as O}from"./DialogFooter.vue_vue_type_script_setup_true_lang-DWQyKxcL.js";import{_ as U}from"./AppLayout.vue_vue_type_script_setup_true_lang-CSeItSDb.js";import"./useForwardPropsEmits-DBR65G6g.js";import"./index-CzYp3ma3.js";import"./VisuallyHidden-mwF0TaSJ.js";import"./useForwardExpose-tI4-tx8q.js";import"./index-n1LTNkzM.js";import"./createLucideIcon-D3bWensk.js";const j={class:"p-4"},F={class:"overflow-x-auto bg-white dark:bg-gray-800 rounded shadow"},T={class:"w-full table-auto text-gray-800 text-sm dark:text-gray-200"},E={class:"p-2"},H={class:"p-2"},J={class:"p-2"},P={class:"p-2"},W={class:"p-2"},q={class:"p-2"},z={class:"p-2"},G=["onClick"],K={class:"mt-4"},Q={key:0,class:"flex gap-2"},R=["innerHTML","disabled","onClick"],X={class:"px-0 sm:px-6"},Y={class:"max-h-[60vh] overflow-y-auto"},Z={key:0,class:"p-4"},tt={key:1,class:"p-4 space-y-3"},st={class:"text-sm font-mono bg-gray-100 dark:bg-gray-800 p-2 rounded whitespace-pre-wrap break-words"},et={class:"text-sm font-mono bg-gray-100 dark:bg-gray-800 p-2 rounded whitespace-pre-wrap break-words"},_t=$({__name:"Index",props:{logs:{}},setup(w){const c=w,h=[{title:"Admin",href:"/admin"},{title:"Audit Logs",href:"/admin/audit-logs"}],k=p=>{p&&(window.location.href=p)},m=b(!1),_=b(!1),o=b(null),x=async p=>{_.value=!0;try{const s=await fetch(`/admin/audit-logs/${p}`,{headers:{Accept:"application/json"},credentials:"same-origin"});if(!s.ok)throw new Error("Failed to load log");o.value=await s.json(),m.value=!0}catch(s){console.error(s),alert("Unable to load audit log")}finally{_.value=!1}};return(p,s)=>(d(),i(g,null,[l(r(C),{title:"Audit Logs"}),l(U,{breadcrumbs:h},{default:n(()=>[t("div",j,[s[11]||(s[11]=t("h1",{class:"text-2xl font-bold mb-4"},"Audit Logs",-1)),t("div",F,[t("table",T,[s[1]||(s[1]=t("thead",null,[t("tr",{class:"text-left bg-gray-50 dark:bg-gray-700"},[t("th",{class:"p-2"},"ID"),t("th",{class:"p-2"},"User"),t("th",{class:"p-2"},"Action"),t("th",{class:"p-2"},"Module"),t("th",{class:"p-2"},"IP"),t("th",{class:"p-2"},"When"),t("th",{class:"p-2"},"View")])],-1)),t("tbody",null,[(d(!0),i(g,null,v(c.logs.data,e=>(d(),i("tr",{key:e.id,class:"border-t border-gray-200 dark:border-gray-700 odd:bg-white even:bg-gray-50 dark:odd:bg-transparent dark:even:bg-gray-900"},[t("td",E,a(e.id),1),t("td",H,a(e.user?e.user.name:"—"),1),t("td",J,a(e.action),1),t("td",P,a(e.module),1),t("td",W,a(e.ip_address),1),t("td",q,a(new Date(e.created_at).toLocaleString()),1),t("td",z,[t("button",{onClick:y(L=>x(e.id),["prevent"]),class:"cursor-pointer text-blue-600 hover:underline"},"View",8,G)])]))),128))])])]),t("div",K,[c.logs.links?(d(),i("div",Q,[(d(!0),i(g,null,v(c.logs.links,e=>(d(),i("button",{key:e.label,innerHTML:e.label,disabled:!e.url,onClick:y(L=>k(e.url),["prevent"]),class:"px-3 py-1 rounded border text-sm border-gray-200 dark:border-gray-700 text-gray-800 dark:text-gray-200 bg-white dark:bg-transparent"},null,8,R))),128))])):f("",!0)]),l(r(N),{open:m.value,"onUpdate:open":s[0]||(s[0]=e=>m.value=e)},{default:n(()=>[l(r(V),{class:"sm:max-w-2xl max-w-full"},{default:n(()=>[l(r(M),{class:"border-b border-gray-200 dark:border-gray-700 pb-3 mb-3"},{default:n(()=>[l(r(S),null,{default:n(()=>[...s[2]||(s[2]=[u("Audit Log Details",-1)])]),_:1}),o.value?(d(),A(r(B),{key:0},{default:n(()=>[u(" Log #"+a(o.value.id)+" — "+a(o.value.action),1)]),_:1})):f("",!0)]),_:1}),t("div",X,[t("div",Y,[_.value?(d(),i("div",Z,"Loading…")):o.value?(d(),i("div",tt,[t("p",null,[s[3]||(s[3]=t("strong",null,"User:",-1)),u(" "+a(o.value.user?o.value.user.name:"—"),1)]),t("p",null,[s[4]||(s[4]=t("strong",null,"Action:",-1)),u(" "+a(o.value.action),1)]),t("p",null,[s[5]||(s[5]=t("strong",null,"Module:",-1)),u(" "+a(o.value.module),1)]),t("p",null,[s[6]||(s[6]=t("strong",null,"IP:",-1)),u(" "+a(o.value.ip_address),1)]),t("p",null,[s[7]||(s[7]=t("strong",null,"Created:",-1)),u(" "+a(new Date(o.value.created_at).toLocaleString()),1)]),t("div",null,[s[8]||(s[8]=t("h4",{class:"font-medium"},"Old Data",-1)),t("div",st,a(JSON.stringify(o.value.old_data,null,2)),1)]),t("div",null,[s[9]||(s[9]=t("h4",{class:"font-medium"},"New Data",-1)),t("div",et,a(JSON.stringify(o.value.new_data,null,2)),1)])])):f("",!0)])]),l(r(I),{class:"mt-4"},{default:n(()=>[l(r(O),{"as-child":""},{default:n(()=>[l(r(D),{variant:"secondary"},{default:n(()=>[...s[10]||(s[10]=[u("Close",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["open"])])]),_:1})],64))}});export{_t as default};
